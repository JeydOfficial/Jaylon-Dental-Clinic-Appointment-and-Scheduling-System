{% extends "frontend_base.html" %}
{% load static %}
{% block content %}

{% if request.user.is_restricted %}
<div class="alert alert-warning alert-dismissible fade show position-fixed w-100 text-center mb-0" style="z-index: 1060;" role="alert">
  <i class="fas fa-exclamation-triangle"></i>
  <strong>Account Restricted:</strong> Due to missed appointments, you can't book new appointments until
  {{ request.user.restriction_end_time|date:"F d, Y" }} at {{ request.user.restriction_end_time|time:"g:i A" }}.
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}

<nav id="navbar-example2" class="navbar navbar-expand-lg sticky-top bg-white px-3">
    <div class="container-fluid">
        <a class="navbar-brand" href="{% url 'client_dashboard' %}"><i class="fas fa-tooth mr-2 text-primary"></i> Jaylon Dental Clinic</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav nav-pills me-auto my-1">
                <li class="nav-item">
                    <a class="nav-link px-2" href="#scrollspyHome"><i class="fas fa-home"></i> Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link px-2" href="#scrollspyService"><i class="fas fa-tools"></i> Services</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link px-2" href="#scrollspyGallery"><i class="fas fa-images"></i> Gallery</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link px-2" href="#scrollspyContacts"><i class="fas fa-envelope"></i> Contacts</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link px-2" href="#scrollspyPrivacy"><i class="fas fa-user-shield"></i> Privacy and Agreement</a>
                </li>
            </ul>
            <ul class="navbar-nav nav-pills">
                {% if request.user.is_authenticated and not request.user.is_superuser %}
                <li class="nav-item ms-auto">
                    <a class="btn btn-outline-primary btn-sm me-2" href="{% url 'client_profile' %}"><i
                            class="fas fa-user"></i> Profile</a>
                    <a class="btn btn-outline-danger btn-sm" href="{% url 'client_logout' %}"><i
                            class="fas fa-sign-out-alt"></i> Logout</a>
                </li>
                {% else %}
                <li class="nav-item ms-auto">
                    <a class="btn btn-primary" href="{% url 'client_login' %}"><i class="fas fa-calendar-check"></i>
                        BOOK NOW</a>
                </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<div data-bs-spy="scroll" data-bs-target="#navbar-example2" data-bs-root-margin="0px 0px -40%"
     data-bs-smooth-scroll="true" class="container-fluid scrollspy-example bg-body-tertiary p-3 rounded-2" tabindex="0">

    <div id="scrollspyHome" class="mt-4" data-aos="fade-up">
        {% if request.user.is_authenticated and not request.user.is_superuser %}
        <div class="row gy-5">
            <div class="col-md-6">
                <h3><i class="fas fa-calendar-plus text-primary"></i> Book an Appointment</h3>
                <form method="post" id="appointment-form">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="serviceSelect" class="form-label">Service</label>
                        <select class="form-select" name="service" id="serviceSelect" required>
                            <option value="">--Select Service--</option>
                            {% for service in services %}
                                <option value="{{ service.id }}">{{ service.title }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="dateInput" class="form-label">Preferred Date</label>
                        <input type="date" class="form-control" name="date" id="dateInput" required>
                    </div>
                    <div class="mb-3">
                        <label for="timeSlotSelect" class="form-label">Preferred Time</label>
                        <select class="form-select" name="time_slot" id="timeSlotSelect" required>
                            <option value="">--Select Time--</option>
                        </select>
                    </div>
          <div class="mb-3">
            <div class="g-recaptcha" data-sitekey="{{ recaptcha_site_key }}"></div>
          </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-check"></i> Book Appointment
                        </button>
                    </div>
                </form>
            </div>
            <div class="col-md-6">
                <h3><i class="fas fa-history text-primary"></i> Appointment History</h3>
                <div class="table-responsive">
                    <table id="appointmentHistoryTable" class="table table-striped">
                        <thead>
                        <tr>
                            <th>Service</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Status</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for appointment in appointments %}
                        <tr>
                            <td>{{ appointment.service }}</td>
                            <td>{{ appointment.date }}</td>
                            <td>{{ appointment.start_time }} - {{ appointment.end_time }}</td>
                            <td>
                                {% if appointment.status == 'Approved' %}
                                <span class="badge bg-success"><i class="fas fa-check-circle"></i> {{ appointment.status }}</span>
                                {% elif appointment.status == 'Pending' %}
                                <span class="badge bg-warning"><i
                                        class="fas fa-clock"></i> {{ appointment.status }}</span>
                                {% else %}
                                <span class="badge bg-danger"><i class="fas fa-times-circle"></i> {{ appointment.status }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% else %}
        <h1 class="text-center mb-4">Welcome to Jaylon Dental Clinic</h1>
        <p class="lead text-center">Your journey to a brighter smile starts here!</p>
        <div class="text-center">
            <a href="{% url 'client_login' %}" class="btn btn-primary btn-lg"><i class="fas fa-calendar-check"></i> Book
                Your Appointment Now</a>
        </div>
        {% endif %}
    </div>

    <div id="scrollspyService" class="mt-4" aos="fade-up">
      <h3 class="mb-4" aos="fade-right">Our Services</h3>
      <p>Discover the range of dental services we offer to keep your smile healthy and beautiful.</p>

      <div class="row">
        {% for service in services %}
        <div class="col-md-6 col-lg-4 mb-4" aos="zoom-in" aos-delay="{{ forloop.counter0|divisibleby:3|yesno:'0,100,200' }}">
          <div class="card h-100 shadow-sm">
            <img src="{{ service.image.url }}" class="card-img-top service-image" alt="{{ service.title }}" style="height: 200px; object-fit: cover;" data-bs-toggle="modal" data-bs-target="#servicesModal" data-bs-slide-to="{{ forloop.counter0 }}">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{{ service.title }}</h5>
              <p class="card-text flex-grow-1">{{ service.description|truncatewords:20 }}</p>
              <div class="mt-auto">
                <small class="text-muted">Duration: {{ service.duration }} minutes</small>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Services Modal -->
    <div class="modal fade" id="servicesModal" tabindex="-1" aria-labelledby="servicesModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="servicesModalLabel">Our Services</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body p-0">
            <div id="servicesCarousel" class="carousel slide" data-bs-ride="carousel">
              <div class="carousel-inner">
                {% for service in services %}
                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                  <img src="{{ service.image.url }}" class="d-block w-100" alt="{{ service.title }}" style="height: 300px; object-fit: cover;">
                  <div class="carousel-caption d-block bg-dark bg-opacity-75 text-start p-3">
                    <h5 class="mb-2">{{ service.title }}</h5>
                    <p class="mb-2 small">{{ service.description }}</p>
                    <p class="mb-0"><small>Duration: {{ service.duration }} minutes</small></p>
                  </div>
                </div>
                {% endfor %}
              </div>
              <button class="carousel-control-prev" type="button" data-bs-target="#servicesCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#servicesCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="scrollspyGallery" class="mt-4" aos="fade-up">
      <h3 class="mb-4" aos="fade-right">Clinic Gallery</h3>
      <p>Take a virtual tour of our state-of-the-art facilities.</p>

      <div class="row">
        {% for image in images %}
        <div class="col-md-4 col-lg-3 mb-4" aos="flip-left" aos-delay="{{ forloop.counter0|divisibleby:4|yesno:'0,100,200,300' }}">
          <div class="card">
            <img src="{{ image.image.url }}" class="img-thumbnail gallery-image" alt="Clinic Image {{ forloop.counter }}" style="height: 300px; object-fit: cover;" data-bs-toggle="modal" data-bs-target="#galleryModal" data-bs-slide-to="{{ forloop.counter0 }}">
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Gallery Modal -->
    <div class="modal fade" id="galleryModal" tabindex="-1" aria-labelledby="galleryModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="galleryModalLabel">Clinic Gallery</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body p-0">
            <div id="galleryCarousel" class="carousel slide" data-bs-ride="carousel">
              <div class="carousel-inner">
                {% for image in images %}
                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                  <div class="zoom-container">
                    <img src="{{ image.image.url }}" class="d-block w-100 zoomable-image" alt="Clinic Image {{ forloop.counter }}">
                  </div>
                </div>
                {% endfor %}
              </div>
              <button class="carousel-control-prev" type="button" data-bs-target="#galleryCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#galleryCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="scrollspyContacts" class="mt-4" data-aos="fade-up">
        <h3 class="mb-4" data-aos="fade-right"><i class="fas fa-envelope text-primary"></i> Contact Us</h3>
        <p class="lead" data-aos="fade-left">We're here to answer your questions and address your concerns.</p>
        <div class="row gy-5">
            <div class="col-md-6" data-aos="fade-up">
                <form method="post" id="contactForm">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="contactName" class="form-label">Name</label>
                        <input type="text" class="form-control" id="contactName" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="contactEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="contactEmail" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="contactMessage" class="form-label">Message</label>
                        <textarea class="form-control" id="contactMessage" rows="4" name="message" required></textarea>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Send Message
                        </button>
                    </div>
                </form>
            </div>
            <div class="col-md-5 offset-md-1" data-aos="fade-up">
                <h4><i class="fas fa-info-circle"></i> Clinic Information</h4>
                <p><i class="fas fa-map-marker-alt"></i> <strong>Address:</strong> Dayao St, Kidapawan City, Cotabato
                </p>
                <p><i class="fas fa-phone"></i> <strong>Phone:</strong> 09876543210</p>
                <p><i class="fas fa-envelope"></i> <strong>Email:</strong> info@jaylondentalclinic.com</p>
                <h4 class="mt-4"><i class="far fa-clock"></i> Office Hours</h4>
                <p>Monday - Saturday: 8:30 AM - 4:00 PM</p>
                <p>Sunday: 9:00 AM - 12:00 PM</p>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-12" data-aos="zoom-in">
                <h4><i class="fas fa-map-marked-alt"></i> Find Us</h4>
                <div class="embed-responsive embed-responsive-16by9">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3959.967304180738!2d125.08718601145742!3d7.013128192959139!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x32f8f9e289b147af%3A0xa6fd91898c8910a0!2sJaylon%20Dental%20group!5e0!3m2!1sen!2sph!4v1725349059605!5m2!1sen!2sph"
                            width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
                </div>
            </div>
        </div>
    </div>

    <div id="scrollspyPrivacy" class="mt-4" aos="fade-up">
    <h3 class="mb-4" aos="fade-right"><i class="fas fa-user-shield text-primary"></i> Privacy and Agreement</h3>
    <div class="row">
        <div class="col-md-12">
            <p>At Jaylon Dental Clinic, we value your privacy and are committed to protecting your personal information. By using our services, you agree to the terms outlined in our privacy policy and user agreement.</p>
            <p>For more details, please read our full <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy Policy and User Agreement</a>.</p>
        </div>
    </div>
</div>

    <!-- Privacy Policy Modal -->
    <div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="privacyModalLabel">Privacy Policy and User Agreement</h5>
                </div>
                <div class="modal-body">
                    <h6>Privacy Policy</h6>
                    <p>Our privacy policy outlines how we collect, use, and protect your personal information...</p>

                    <h6>User Agreement</h6>
                    <p>By using our services, you agree to the following terms and conditions...</p>

                    <!-- Add more detailed content here -->

                    <div class="form-check mt-3">
                        <input class="form-check-input" type="checkbox" id="agreeCheckbox"
                               {% if request.user.has_agreed_privacy_policy %}checked{% endif %}>
                        <label class="form-check-label" for="agreeCheckbox">
                            I agree to the Policy and Agreement of Jaylon Dental Clinic
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="agreeButton" disabled>I Agree</button>
                </div>
            </div>
        </div>
    </div>
</div>

<footer class="bg-secondary text-light py-3" data-aos="fade-down">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8 text-center">
                <h5 class="mb-4">Connect With Us</h5>
                <div class="d-flex justify-content-center">
                    <a href="https://www.facebook.com/profile.php?id=100083282165584" target="_blank" class="social-icon mx-3">
                        <i class="fab fa-facebook fa-2x"></i>
                    </a>
                    <a href="https://www.instagram.com/dr_jaylon?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw==" target="_blank" class="social-icon mx-3">
                        <i class="fab fa-instagram fa-2x"></i>
                    </a>
                </div>
                <p class="mt-2">&copy; 2024 Jaylon Dental Clinic. All rights reserved.</p>
            </div>
        </div>
    </div>
</footer>

{% endblock %}
